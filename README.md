# OnlyEducation

### Задача
Написать свой компонент на основе news.list
1.	Компонент должен уметь получать все злементы только по типу инфоблока(без ID конкретного инфоблока)
2.	Если ID инфоблока передан, компонент получает элементы только этого инфоблока(по сути, обычный news.list)
3.	Компонент должен группировать элементы в $arResult['ITEMS'] по ID инфоблоков, из которых они были получены
4.	Компонент должен иметь ООП структуру(вся логика должна быть реализована в class.php в виде методов)
5.	(Дополнительно) Добавить поддержку фильтрации по полям.
6.	(Дополнительно) Добавить проверку вводимых параметров и вывод ошибок через ShowError.

### Как сделано.

В массив $arIBlocks (в файле .parameters.php) добавлен элемент с ключом [0] – «Все инфоблоки выбранного типа», в случае выбора его в параметрах компонент получит все элементы выбранного типа инфоблока.

Логика компонента реализована в class.php

Если в настройках компонента выбран инфоблок ($arParams["IBLOCK_ID"] > 0) получаем выбранный инфоблок и выполняем функцию setArResultIfOneIBlock().
Если в настройках компонента конкретный инфоблок не выбран, то получаем все инфоблоки выбранного типа ("TYPE" => $arParams["IBLOCK_TYPE"]) и выполняем функцию setArResultIfSomeIBlock().

Внутри обеих функций выполняется функция getItemsAndElements() с передачей в нее ссылок на массивы для хранения ITEMS и ELEMENTS. В функции setArResultIfOneIBlock() функция getItemsAndElements() выполняется один раз, а в функции setArResultIfSomeIBlock() - в цикле для каждого инфоблока выбранного типа.

Для компонента, если был выбран конкретный инфоблок, сохранена штатная функциональность (пагинация, заполнение метатегов, формирование цепочки навигации). Если выбран только тип инфоблока, необходима корректировка соответствующих функций с учётом конкретного технического задания.

#### Пункт 5 задания.
Фильтрация по полям работает. Параметры фильтра хранятся в массиве $arrFilter и учитываются при получении элементов.

#### Пункт 6 задания.
В качестве примера сделана проверка содержащегося в выбранных в параметрах компонента свойствах значения на соответствие его адресу e-mail с помощью функции check_email. Можно использовать preg_match.

Для этого в .parameters.php добавлен выбор свойств элемента для e-mail валидации
```
        "PROPERTY_CODE_VALIDATE_EMAIL" => array(
            "PARENT" => "ADDITIONAL_SETTINGS",
            "NAME" => GetMessage("T_IBLOCK_PROPERTY_VALIDATE_EMAIL"),
            "TYPE" => "LIST",
            "MULTIPLE" => "Y",
            "VALUES" => $arProperty_LNS,
            "ADDITIONAL_VALUES" => "Y",
        ),
```        
В class.php в функции getItemsAndElements() при формировании значений свойств элементов в arResult проводится проверка и при несоответствии перезаписывается значение свойства. 

Поскольку массивы [ITEMS] и [ELEMENTS] формируются по-разному в зависимости от выбора конкретного инфоблока, можно добавить разные шаблоны для вывода элементов.
```
            if($arParams["IBLOCK_ID"] > 0)
            {
                ...
                $this->templatePage = "template_one_block"
            }
            else
            {
                ...
                $this->templatePage = "template_some_block"
            }

            ...

            $this->includeComponentTemplate($this->templatePage);
```
В шаблоне для вывода элементов, если выбран только тип инфоблока, добавить еще один цикл:
```
<?foreach($arResult["ITEMS"] as $arIblock):?>
  <?foreach($arIblock as $arItem):?>
    ...
  <?endforeach;?>
<?endforeach;?>
```
